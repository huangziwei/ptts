<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ptts preview</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f5f1ea;
      --ink: #1f1a14;
      --accent: #e36f4b;
      --panel: #ffffff;
      --muted: #6a5f55;
    }
    body {
      margin: 0;
      font-family: "Georgia", "Times New Roman", serif;
      background: var(--bg);
      color: var(--ink);
    }
    header {
      padding: 20px 24px;
      background: linear-gradient(120deg, #f1d9c5, #f7efe6);
      border-bottom: 1px solid #e3d7c9;
    }
    header h1 {
      margin: 0 0 6px 0;
      font-size: 22px;
    }
    header .meta {
      font-size: 14px;
      color: var(--muted);
    }
    main {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 18px;
      padding: 18px 24px 24px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid #eadfd4;
      border-radius: 10px;
      padding: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .chapter-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 72vh;
      overflow-y: auto;
      padding-right: 6px;
    }
    .chapter-list a {
      text-decoration: none;
      color: var(--ink);
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 14px;
    }
    .chapter-list a.active {
      background: var(--accent);
      color: #fff;
    }
    .chapter-list a:hover {
      background: #f3e3d6;
    }
    .split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    h2 {
      font-size: 16px;
      margin: 0 0 8px 0;
    }
    pre {
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 14px;
    }
    mark {
      background: #ffe4a8;
      padding: 0 2px;
      border-radius: 3px;
    }
    .actions {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    button {
      border: none;
      background: var(--accent);
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    button.secondary {
      background: #c9b7a6;
    }
    .rules textarea {
      width: 100%;
      min-height: 90px;
      border: 1px solid #e3d7c9;
      border-radius: 6px;
      padding: 6px;
      font-family: "SFMono-Regular", ui-monospace, monospace;
      font-size: 12px;
    }
    .rules label {
      display: block;
      font-size: 13px;
      margin: 8px 0 4px;
    }
    .drop-list {
      font-size: 13px;
      color: var(--muted);
      margin-top: 12px;
    }
    @media (max-width: 960px) {
      main {
        grid-template-columns: 1fr;
      }
      .split {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ptts sanitize preview</h1>
    <div class="meta">{{ book_dir }}</div>
  </header>
  <main>
    <section class="panel">
      <div class="actions">
        <form method="post" action="/sanitize">
          <button type="submit">Re-sanitize</button>
        </form>
        <a href="/"><button class="secondary" type="button">Reload</button></a>
      </div>
      <div class="chapter-list">
        {% for entry in chapters %}
          <a href="/?chapter={{ entry.index }}" class="{% if selected and entry.index == selected.index %}active{% endif %}">
            {{ entry.index }}. {{ entry.title }}
          </a>
        {% endfor %}
      </div>
      {% if report and report.chapters %}
        <div class="drop-list">
          <strong>Dropped</strong><br />
          {% for entry in report.chapters %}
            {% if entry.dropped %}
              <div style="display:flex; align-items:center; gap:6px; margin-top:4px;">
                <span>{{ entry.index }}. {{ entry.title }}</span>
                <form method="post" action="/restore" style="margin:0;">
                  <input type="hidden" name="title" value="{{ entry.title }}" />
                  <button type="submit" class="secondary">Restore</button>
                </form>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </section>

    <section>
      <div class="panel" style="margin-bottom:16px;">
        {% if selected %}
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
            <div>
              <strong>Selected:</strong> {{ selected.title }}
            </div>
            {% if selected.kind != "title" %}
              <form method="post" action="/drop" style="margin:0;">
                <input type="hidden" name="title" value="{{ selected.title }}" />
                <input type="hidden" name="chapter" value="{{ selected.index }}" />
                <button type="submit" class="secondary">Drop this chapter</button>
              </form>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="panel split">
        <div>
          <h2>Raw</h2>
          <pre>{{ raw_text | safe }}</pre>
        </div>
        <div>
          <h2>Clean</h2>
          <pre>{{ clean_text | safe }}</pre>
        </div>
      </div>

      <div class="panel rules" style="margin-top:16px;">
        <form method="post" action="/rules">
          <label>Drop chapter title patterns</label>
          <textarea name="drop_patterns">{{ rules_text.drop }}</textarea>
          <label>Section cutoff patterns</label>
          <textarea name="cutoff_patterns">{{ rules_text.cutoff }}</textarea>
          <label>Remove patterns</label>
          <textarea name="remove_patterns">{{ rules_text.remove }}</textarea>
          <label><input type="checkbox" name="replace_defaults" {% if rules.replace_defaults %}checked{% endif %}/> Replace defaults</label>
          <div style="margin-top:10px;">
            <button type="submit">Save rules</button>
          </div>
        </form>
      </div>
    </section>
  </main>
</body>
</html>
